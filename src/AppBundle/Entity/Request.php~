<?php
/**
 * Created by PhpStorm.
 * User: Alexey Grigoriev
 * Date: 04.09.2017
 * Time: 16:47
 */

namespace AppBundle\Entity;
use Symfony\Component\Validator\Constraints as Assert;
use Doctrine\ORM\Mapping as ORM;

/**
 * Class Request
 * @package AppBundle\Model
 * @ORM\Entity
 * @ORM\Table(name="request")
 */
class Request {
    protected $fields = ['id','name','description','comment','status', 'priority',
                         'active', 'file','category','user','executor','lifecycle'];
    const STATUS_OPENED = 1;
    const STATUS_DISTRIBUTED = 2;
    const STATUS_PROCESSED = 3;
    const STATUS_CHECKING = 4;
    const STATUS_CLOSED = 5;
    //
    const PRIORITY_LOW = 1;
    const PRIORITY_MEDIUM = 2;
    const PRIORITY_HIGH = 3;
    const PRIORITY_CRITICAL = 4;
    /**
     * @var int
     * @ORM\Id
     * @ORM\Column(type="integer")
     * @ORM\GeneratedValue(strategy="AUTO")
     */
    public $id;
    /**
     * @var string Название заявки
     * @ORM\Column(type="string", length=50)
     * @Assert\NotBlank(message="entity.common.notBlank")
     * @Assert\Length( max = 50, maxMessage="model.common.strLength.{{limit}}" )
     */
    private $name;
    /**
     * @var string Описание заявки
     * @ORM\Column(type="string", length=200, nullable=true)
     * @Assert\NotBlank(message="entity.common.notBlank")
     * @Assert\Length( max = 200, maxMessage="model.common.strLength.{{limit}}" )
     */
    private $description;

    /**
     * @var Comment[] Комментарий к заявке
     * @ORM\OneToMany(targetEntity="Comment", mappedBy="request")
     */
    private $comments;
    /**
     * @var int Статус
     * @ORM\Column(type="integer", options={ "default": 1} )
     */
    private $status;
    /**
     * @var int Приоритет
     * @ORM\Column(type="integer", options={ "default": 2} )
     */
    private $priority;
    /**
     * @var Active Кабинет в отделе
     * @ORM\ManyToOne(targetEntity="Active")
     * @ORM\JoinColumn(name="active_id", referencedColumnName="id", onDelete="SET NULL", nullable=true)
     */
    private $active;
    /**
     * @var string Файл с подробностями проблемы
     * @ORM\Column(type="string", length=200, nullable=true)
     */
    private $file;
    /**
     * @var Category Категрия проблемы
     * @ORM\ManyToOne(targetEntity="Category")
     * @ORM\JoinColumn(name="category_id", referencedColumnName="id", onDelete="SET NULL", nullable=true)
     */
    private $category;
    /**
     * @var User Автор заявки о проблеме
     * @ORM\OneToOne(targetEntity="User")
     * @ORM\JoinColumn(name="user_id", referencedColumnName="id", onDelete="SET NULL", nullable=true)
     */
    private $user;
    /**
     * @var User Кто будет решать проблему
     * @ORM\OneToOne(targetEntity="User")
     * @ORM\JoinColumn(name="executor_id", referencedColumnName="id", onDelete="SET NULL", nullable=true)
     */
    private $executor;

    /**
     * @var Lifecycle Временные отметки изменения статуса текущей заявки
     * @ORM\OneToOne(targetEntity="Lifecycle")
     * @ORM\JoinColumn(name="lifecycle_id", referencedColumnName="id", onDelete="CASCADE")
     */
    private $lifecycle;



    public function __toString(){
        return $this->getName();
    }

    /* ====================================== ============= */
}
