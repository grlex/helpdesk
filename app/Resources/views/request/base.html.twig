{% extends 'main_template.html.twig' %}

{% block stylesheets %}
    {{ parent() }}

    <link type="text/css" rel="stylesheet" href="{{ asset('css/comments.css?i') }}"/>
    <link type="text/css" rel="stylesheet" href="{{ asset('js/trumbowyg/ui/trumbowyg.min.css') }}"/>
    <link type="text/css" rel="stylesheet" href="{{ asset('css/file_collection_theme.css') }}"/>


{% endblock %}
{% block javascripts %}
    {{ parent() }}

    <script src="{{ asset('js/trumbowyg/trumbowyg.min.js') }}"></script>
    <script src="{{ asset('js/trumbowyg/langs/ru.min.js') }}"></script>
    <script src="{{ asset('js/trumbowyg/plugins/upload/trumbowyg.upload.min.js') }}"></script>
    <script src="{{ asset('js/file_collection_theme.js') }}"></script>
    <script>
        $('.chosen-element').chosen({
            allow_single_deselect: true,
            width: '100%'
        });

        var trumbowygConfig = {
            btns: [
                ['viewHTML'],
                ['undo', 'redo'], // Only supported in Blink browsers
                ['formatting'],
                ['strong', 'em', 'underline'],
                ['superscript', 'subscript'],
                ['link'],
                ['image'],
                ['justify'],
                ['unorderedList', 'orderedList'],
                ['horizontalRule'],
                ['removeformat'],
                ['fullscreen']
            ],
            btnsDef: {
                justify: {
                    dropdown: ['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull'],
                    ico: 'justify-left',
                    hasIcon: true
                },
                image: {
                    dropdown: ['insertImage', 'upload'],
                    ico: 'insertImage'
                },
                insertImage:{
                    title: jQuery.trumbowyg.langs['{{ app.request.locale|slice(0,2) }}'].imageByLink
                }
            },
            autogrow: true,
            lang: 'ru',
            placeholder: "{{ 'comment_placeholder'|trans }}",
            resetCss: true,
            plugins: {
                upload: {
                    serverPath: '/file/upload',
                    fileFieldName: 'file',
                    urlPropertyName: 'data.link'
                }
            }
        };

        $('.wysiwyg-element, ' +
          '.wysiwyg-container textarea').trumbowyg(trumbowygConfig);


        var form, textarea;
        $(document).on('fos_comment_load_thread', '#fos_comment_thread', function (event, id) {
            form = $(this).find('.fos_comment_comment_new_form');
            textarea = form.find('textarea');
            textarea.attr('placeholder', trumbowygConfig.placeholder);
            textarea.trumbowyg(trumbowygConfig);
            textarea.parent().css('min-height','100');
            textarea.height(100);

        });
        $(document).on('fos_comment_submitted_form', '#fos_comment_thread', function (event, statusCode) {
            if(statusCode!==200) return;
            textarea.trumbowyg('empty');
        });

    </script>
{% endblock %}